var GameManager=pc.createScript("gameManager");GameManager.attributes.add("UiManager",{type:"entity"}),GameManager.attributes.add("GameDurationInSec",{type:"number"}),GameManager.attributes.add("StarCount",{type:"number"}),GameManager.attributes.add("Time",{type:"number"}),GameManager.attributes.add("BatteryCount",{type:"number"}),GameManager.attributes.add("IsGameStart",{type:"boolean",default:!1}),GameManager.attributes.add("GroupDetector",{type:"entity"}),GameManager.attributes.add("WhaleWaveSignal",{type:"entity"}),GameManager.attributes.add("GroupWhaleWaveSignal",{type:"entity"}),GameManager.attributes.add("TargetIndication",{type:"entity"}),GameManager.attributes.add("PlayerAnimGroup",{type:"entity"}),GameManager.attributes.add("WhalePlayer",{type:"entity"}),GameManager.attributes.add("WhaleGroup",{type:"entity"}),GameManager.prototype.initialize=function(){this.UiManager.script.uimanager.UpdateTimer(this.GameDurationInSec),this.AddBatteryCount(0),setTimeout((()=>{globalVariables.IsGamePause=!1,this.IsGameStart=!0}),2e3),this.StartEndTimer=!1,this.TotalTime=0},GameManager.prototype.update=function(e){this.StartEndTimer&&(this.TotalTime-=60*e,this.UiManager.script.uimanager.UpdateTimer(this.TotalTime),this.TotalTime<0&&(this.UiManager.script.uimanager.UpdateTimer(0),this.StartEndTimer=!1)),globalVariables.IsGamePause||this.IsGameStart&&(this.UiManager.script.uimanager.UpdateTimer(this.GameDurationInSec),this.GameDurationInSec-=e,this.GameDurationInSec<0&&(console.log("Timeout"),this.TimeOut(),this.IsGameStart=!1))},GameManager.prototype.AddBatteryCount=function(e){this.BatteryCount+=e,this.UiManager.script.uimanager.UpdateBatteryCount(this.BatteryCount)},GameManager.prototype.ReduceBatteryCount=function(e){this.BatteryCount-=e,this.BatteryCount<0&&(this.BatteryCount=0),this.UiManager.script.uimanager.UpdateBatteryCount(this.BatteryCount)},GameManager.prototype.CollectStars=function(){this.UiManager.script.uimanager.UpdateScore(this.StarCount)},GameManager.prototype.ShowWhaleSignal=function(){globalVariables.IsControllBlocked||this.BatteryCount>0&&(this.PlayerAnimGroup.anim.setTrigger("Shoot"),this.ReduceBatteryCount(1),globalVariables.IsControllBlocked=!0,this.WhaleWaveSignal.enabled=!0,this.GroupDetector.enabled=!0,setTimeout((()=>{globalVariables.IsControllBlocked=!1,this.WhaleWaveSignal.enabled=!1,this.GroupDetector.enabled=!1,this.CheckGroupWhaleDetection()}),2e3))},GameManager.prototype.CheckGroupWhaleDetection=function(){globalVariables.IsGroupWhaleDeteced&&(this.ShowGroupWhaleSignal(),globalVariables.IsGroupWhaleDeteced=!1)},GameManager.prototype.ShowGroupWhaleSignal=function(){var e=this.WhalePlayer.getPosition(),a=this.WhaleGroup.getPosition(),t=(e.x+a.x)/2,i=(e.y+a.y)/2,r=(e.z+a.z)/2,n=new pc.Vec3;n.x=t,n.y=i,n.z=r,this.GroupWhaleWaveSignal.setPosition(n),console.log(this.GroupWhaleWaveSignal.getEulerAngles()),this.GroupWhaleWaveSignal.lookAt(this.WhalePlayer.getPosition()),console.log(this.GroupWhaleWaveSignal.getEulerAngles()),this.GroupWhaleWaveSignal.enabled=!0,this.TargetIndication.enabled=!0,setTimeout((()=>{this.GroupWhaleWaveSignal.enabled=!1,this.TargetIndication.enabled=!1}),2e3)},GameManager.prototype.TimeOut=function(){globalVariables.IsGamePause=!0,globalVariables.IsControllBlocked=!0,this.UiManager.script.uimanager.ShowTimeOut(this.StarCount)},GameManager.prototype.GroupFinded=function(){globalVariables.IsGamePause=!0,globalVariables.IsControllBlocked=!0,this.WhaleGroup.script.whaleGroupHandler.PlayHappyAnimation(),setTimeout((()=>{this.TotalTime=this.GameDurationInSec,this.StartEndTimer=!0,this.GameEnd()}),5e3)},GameManager.prototype.GameEnd=function(){this.UiManager.script.uimanager.ShowGameEnd(this.GameDurationInSec)};var SoundManager=pc.createScript("soundManager");SoundManager.prototype.initialize=function(){},SoundManager.prototype.update=function(n){};var Uimanager=pc.createScript("uimanager");Uimanager.attributes.add("TimerTxt",{type:"entity"}),Uimanager.attributes.add("ScoreTxt",{type:"entity"}),Uimanager.attributes.add("StarCollectAnim",{type:"entity"}),Uimanager.attributes.add("StarLoseAnim",{type:"entity"}),Uimanager.attributes.add("PauseBtnEntity",{type:"entity"}),Uimanager.attributes.add("PauseMenuEntity",{type:"entity"}),Uimanager.attributes.add("ResumeBtnEntity",{type:"entity"}),Uimanager.attributes.add("RestartBtnEntity",{type:"entity"}),Uimanager.attributes.add("SoundMuteBtn",{type:"entity"}),Uimanager.attributes.add("SoundUnMuteBtn",{type:"entity"}),Uimanager.attributes.add("MobileControls",{type:"entity"}),Uimanager.attributes.add("PcControls",{type:"entity"}),Uimanager.attributes.add("PcWaveBtn",{type:"entity"}),Uimanager.attributes.add("MobileWaveBtn",{type:"entity"}),Uimanager.attributes.add("GameEndEntity",{type:"entity"}),Uimanager.attributes.add("GameEndRemainingTimeTxt",{type:"entity"}),Uimanager.attributes.add("GameEndStarCountTxt",{type:"entity"}),Uimanager.attributes.add("GameEndRestartEntity",{type:"entity"}),Uimanager.attributes.add("GameEndContinueBtnEntity",{type:"entity"}),Uimanager.attributes.add("BatteryCount",{type:"entity"}),Uimanager.attributes.add("TimeOutEntity",{type:"entity"}),Uimanager.attributes.add("TimeOutStarCountTxt",{type:"entity"}),Uimanager.attributes.add("TimeOutRestartEntity",{type:"entity"}),Uimanager.attributes.add("TimeOutContinueBtnEntity",{type:"entity"}),Uimanager.attributes.add("Camera",{type:"entity"}),Uimanager.attributes.add("CameraTarget1",{type:"entity"}),Uimanager.prototype.initialize=function(){this.PauseBtnEntity.button.on("mousedown",this.OnClickPlause,this),this.ResumeBtnEntity.button.on("mousedown",this.OnClickResume,this),this.RestartBtnEntity.button.on("mousedown",this.OnClickRestart,this),this.SoundMuteBtn.button.on("mousedown",this.OnClickMute,this),this.SoundUnMuteBtn.button.on("mousedown",this.OnClickUnMute,this),this.GameEndRestartEntity.button.on("mousedown",this.OnClickRestart,this),this.GameEndContinueBtnEntity.button.on("mousedown",this.OnClickContinue,this),this.TimeOutRestartEntity.button.on("mousedown",this.OnClickRestart,this),this.TimeOutContinueBtnEntity.button.on("mousedown",this.OnClickContinue,this),this.PauseBtnEntity.button.on(pc.EVENT_TOUCHSTART,this.OnClickPlause,this),this.ResumeBtnEntity.button.on(pc.EVENT_TOUCHSTART,this.OnClickResume,this),this.RestartBtnEntity.button.on(pc.EVENT_TOUCHSTART,this.OnClickRestart,this),this.SoundMuteBtn.button.on(pc.EVENT_TOUCHSTART,this.OnClickMute,this),this.SoundUnMuteBtn.button.on(pc.EVENT_TOUCHSTART,this.OnClickUnMute,this),this.GameEndRestartEntity.button.on(pc.EVENT_TOUCHSTART,this.OnClickRestart,this),this.GameEndContinueBtnEntity.button.on(pc.EVENT_TOUCHSTART,this.OnClickContinue,this),this.TimeOutRestartEntity.button.on(pc.EVENT_TOUCHSTART,this.OnClickRestart,this),this.TimeOutContinueBtnEntity.button.on(pc.EVENT_TOUCHSTART,this.OnClickContinue,this),this.MobileWaveBtn.button.on(pc.EVENT_TOUCHSTART,this.OnClickWave,this),this.app.touch?(this.MobileControls.enabled=!0,this.PcControls.enabled=!1):(this.MobileControls.enabled=!1,this.PcControls.enabled=!0),this.StartCoinAnim=!1,this.CoinsCount=0,this.CoinAnimCount=0},Uimanager.prototype.update=function(t){this.app.keyboard.wasPressed(pc.KEY_SPACE)&&this.OnClickWave(),this.StartCoinAnim&&(this.CoinAnimCount+=60*t,this.GameEndStarCountTxt.element.text=Math.round(this.CoinAnimCount),this.CoinsCount<this.CoinAnimCount&&(this.GameEndStarCountTxt.element.text=Math.round(this.CoinAnimCount),this.StartCoinAnim=!1))},Uimanager.prototype.UpdateTimer=function(t){Math.floor(t/3600);var n=Math.floor(t%3600/60),e=Math.round(t%60);this.TimerTxt.element.text=e>9?"0"+n+":"+e:"0"+n+":0"+e},Uimanager.prototype.UpdateScore=function(t){this.ScoreTxt.element.text=t},Uimanager.prototype.UpdateBatteryCount=function(t){this.BatteryCount.element.text=t},Uimanager.prototype.PlayStarCollectAnimation=function(){this.StarCollectAnim.enabled=!0,setTimeout((()=>{this.StarCollectAnim.enabled=!1}),800)},Uimanager.prototype.PlayStarLoseAnimation=function(){this.StarLoseAnim.enabled=!0,setTimeout((()=>{this.StarLoseAnim.enabled=!1}),800)},Uimanager.prototype.OnClickWave=function(){this.Camera.script.cameraFollowHandler.FollowTarget=this.CameraTarget1,globalVariables.GameManager.script.gameManager.ShowWhaleSignal()},Uimanager.prototype.OnClickPlause=function(){globalVariables.IsGamePause||(globalVariables.IsGamePause=!0,this.PauseMenuEntity.enabled=!0,this.app.timeScale=0)},Uimanager.prototype.OnClickResume=function(){this.app.timeScale=1,globalVariables.IsGamePause=!1,this.PauseMenuEntity.enabled=!1},Uimanager.prototype.OnClickMute=function(){this.app.systems.sound.volume=0,this.IsMuted=!1,this.SoundUnMuteBtn.enabled=!0,this.SoundMuteBtn.enabled=!1},Uimanager.prototype.OnClickUnMute=function(){this.app.systems.sound.volume=1,this.IsMuted=!0,this.SoundUnMuteBtn.enabled=!1,this.SoundMuteBtn.enabled=!0},Uimanager.prototype.ShowTimeOut=function(t){this.TimeOutStarCountTxt.element.text=t,this.TimeOutEntity.enabled=!0},Uimanager.prototype.ShowGameEnd=function(t){this.CoinsCount=Math.round(t),this.StartCoinAnim=!0,this.GameEndEntity.enabled=!0},Uimanager.prototype.OnClickContinue=function(t){},Uimanager.prototype.OnClickRestart=function(){this.app.timeScale=1,window.location.reload()};var WhaleController=pc.createScript("whaleController");WhaleController.attributes.add("speed",{type:"number",default:.09}),WhaleController.attributes.add("Camera",{type:"entity"}),WhaleController.attributes.add("Model",{type:"entity"}),WhaleController.attributes.add("Force",{type:"vec3"}),WhaleController.attributes.add("GroupDetectorCollider",{type:"entity"}),WhaleController.attributes.add("MainCollider",{type:"entity"}),WhaleController.prototype.initialize=function(){this.force=new pc.Vec3,this.animationHandler=this.entity.script.whaleAnimationHandler,this.GroupDetectorCollider.collision.on("triggerenter",this.onDetectorTriggerEnter,this),this.MainCollider.collision.on("triggerenter",this.onMainTriggerEnter,this)},WhaleController.prototype.update=function(e){if(!globalVariables.IsControllBlocked){var t=this.app,r=this.Camera.forward,a=(this.Camera.right,0),o=0;this.entity.getPosition(),this.entity.getEulerAngles();if((t.keyboard.isPressed(pc.KEY_LEFT)||t.keyboard.isPressed(pc.KEY_A)||this.animationHandler.LeftTouch)&&this.entity.rotateLocal(0,.9,0),(t.keyboard.isPressed(pc.KEY_RIGHT)||t.keyboard.isPressed(pc.KEY_D)||this.animationHandler.RightTouch)&&this.entity.rotateLocal(0,-.9,0),(t.keyboard.isPressed(pc.KEY_UP)||t.keyboard.isPressed(pc.KEY_W)||this.animationHandler.ForwardTouch)&&(a+=r.x,o+=r.z),0!==a&&0!==o){var i=new pc.Vec3(a,0,o);i.normalize().scale(this.speed),i.add(this.entity.getPosition()),this.entity.rigidbody.teleport(i)}}},WhaleController.prototype.onDetectorTriggerEnter=function(e){e.tags.has("GroupWhale")&&(console.log("Group whale finded"),globalVariables.IsGroupWhaleDeteced=!0)},WhaleController.prototype.onMainTriggerEnter=function(e){e.tags.has("GroupWhale")?(console.log("Group whale finded"),globalVariables.GameManager.script.gameManager.GroupFinded()):e.tags.has("Battery")&&(console.log("Battery finded"),globalVariables.GameManager.script.gameManager.AddBatteryCount(1),e.destroy())};pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);this._add.length&&(this._tweens=this._tweens.concat(this._add),this._add.length=0)}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.EASE_LINEAR,this._sv={},this._ev={}};Tween.prototype={to:function(t,i,e,s,n,r){return t instanceof pc.Vec3?this._properties={x:t.x,y:t.y,z:t.z}:t instanceof pc.Color?(this._properties={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(this._properties.a=t.a)):this._properties=t,this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return t instanceof pc.Vec3?this._properties={x:t.x,y:t.y,z:t.z}:t instanceof pc.Color?(this._properties={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(this._properties.a=t.a)):this._properties=t,this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return t instanceof pc.Quat?this._properties={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Vec3?this._properties={x:t.x,y:t.y,z:t.z}:t instanceof pc.Color?(this._properties={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(this._properties.a=t.a)):this._properties=t,this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(var t in this._properties)this._sv[t]=this._properties[t],this._ev[t]=this.target[t];if(this._slerp){this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z);var i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z;this._fromQuat.setFromEulerAngles(i,e,s)}}else{for(var t in this._properties)this._sv[t]=this.target[t],this._ev[t]=this._properties[t];if(this._slerp){this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z);i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z;this._toQuat.setFromEulerAngles(i,e,s)}}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time=this.time-this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=this.time/this.duration,r=this.easing(n);for(var h in this._properties)e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r;if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtify(!0),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties)tmp=this._sv[i],this._sv[i]=this._ev[i],this._ev[i]=tmp;this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceIn=function(t){return 1-BounceOut(1-t)},BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){var t=pc.Application.getApplication();t&&(t._tweenManager=new pc.TweenManager(t),t.on("update",(function(i){t._tweenManager.update(i)})),pc.Application.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.on("destroy",(function(){e.stop()})),i&&i.element&&(e.element=element),e})}();var CameraMovement=pc.createScript("cameraMovement");CameraMovement.attributes.add("mouseSpeed",{type:"number",default:1.4,description:"Mouse Sensitivity"}),CameraMovement.attributes.add("touchSensitivity",{type:"number",default:5,description:"Touch Sensitivity"}),CameraMovement.prototype.initialize=function(){this.eulers=new pc.Vec3,this.touchCoords=new pc.Vec2;var t=this.app;t.mouse.on("mousemove",this.onMouseMove,this),t.mouse.on("mousedown",(function(){t.mouse.enablePointerLock()}),this),this.lastLTouchPoint=new pc.Vec2,this.LTouchStartPoint=new pc.Vec2,this.LTouch=null,this.Rid=-1,this.Lid=-1,this.velZ=0,this.velX=0,this.rayEnd=t.root.findByName("RaycastEndPoint"),t.touch&&(t.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),t.touch.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this),t.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchEnd,this),t.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this))},CameraMovement.prototype.update=function(t){this.velZ=-1!=this.Lid?this.lastLTouchPoint.y-this.LTouchStartPoint.y:0,this.velX=-1!=this.Lid?this.lastLTouchPoint.x-this.LTouchStartPoint.x:0},CameraMovement.prototype.postUpdate=function(t){var i=this.entity.parent,o=this.eulers.x+180,e=this.eulers.y,s=new pc.Vec3(-e,o,0);i.setEulerAngles(s),this.entity.setPosition(this.getWorldPoint()),this.entity.lookAt(i.getPosition())},CameraMovement.prototype.onMouseMove=function(t){pc.Mouse.isPointerLocked()&&(this.eulers.x-=this.mouseSpeed*t.dx/60%360,this.eulers.y=Math.max(Math.min(this.eulers.y+this.mouseSpeed*t.dy/60%360,89.99),-89.99))},CameraMovement.prototype.onTouchStart=function(t){t.changedTouches.forEach((function(t){var i=this.app.graphicsDevice;t.x>.5*i.width/window.devicePixelRatio&&-1==this.Rid&&(this.Rid=t.id,this.touchCoords.set(t.x,t.y)),t.x<=.5*i.width/window.devicePixelRatio&&-1==this.Lid&&(this.Lid=t.id,this.LTouchStartPoint.set(t.x,t.y),this.lastLTouchPoint.set(t.x,t.y))}),this)},CameraMovement.prototype.onTouchEnd=function(t){t.changedTouches.forEach((function(t){this.Rid==t.id&&(this.Rid=-1),this.Lid==t.id&&(this.Lid=-1)}),this)},CameraMovement.prototype.onTouchMove=function(t){if(this.RTouch=t.getTouchById(this.Rid,t.touches),this.LTouch=t.getTouchById(this.Lid,t.touches),this.RTouch){var i=(this.RTouch.x-this.touchCoords.x)*this.touchSensitivity,o=(this.RTouch.y-this.touchCoords.y)*this.touchSensitivity;this.eulers.x-=this.touchSensitivity*i/60%360,this.eulers.y+=this.touchSensitivity*o/60%360,this.eulers.x<0&&(this.eulers.x+=360),this.eulers.y<0&&(this.eulers.y+=360),this.touchCoords.set(this.RTouch.x,this.RTouch.y)}this.LTouch&&this.lastLTouchPoint.set(this.LTouch.x,this.LTouch.y)},CameraMovement.prototype.getWorldPoint=function(){var t=this.entity.parent.getPosition(),i=this.rayEnd.getPosition(),o=this.app.systems.rigidbody.raycastFirst(t,i);return o?o.point:i};var PlayerMovement=pc.createScript("playerMovement");PlayerMovement.attributes.add("speed",{type:"number",default:.09}),PlayerMovement.attributes.add("Model",{type:"entity"}),PlayerMovement.attributes.add("blendTime",{type:"number",default:.2}),PlayerMovement.attributes.add("velMin",{type:"number",default:10}),PlayerMovement.attributes.add("velMax",{type:"number",default:50}),PlayerMovement.prototype.initialize=function(){var e=this.app,t=e.root.findByName("Camera");this.cameraScript=t.script.cameraMovement,this.force=new pc.Vec3,this.forceX=new pc.Vec3,this.forceZ=new pc.Vec3,e.keyboard.on(pc.EVENT_KEYDOWN,this.keyChange,this),e.keyboard.on(pc.EVENT_KEYUP,this.keyChange,this),this.direction="Idle"},PlayerMovement.prototype.update=function(e){var t=this.app;this.force=pc.Vec3.ZERO.clone();var i=this.entity.forward,r=this.entity.right;if((t.keyboard.isPressed(pc.KEY_LEFT)||t.keyboard.isPressed(pc.KEY_A))&&(this.force.x-=r.x,this.force.z-=r.z),(t.keyboard.isPressed(pc.KEY_RIGHT)||t.keyboard.isPressed(pc.KEY_D))&&(this.force.x+=r.x,this.force.z+=r.z),(t.keyboard.isPressed(pc.KEY_UP)||t.keyboard.isPressed(pc.KEY_W))&&(this.force.x+=i.x,this.force.z+=i.z),(t.keyboard.isPressed(pc.KEY_DOWN)||t.keyboard.isPressed(pc.KEY_S))&&(this.force.x-=i.x,this.force.z-=i.z),this.forceX.copy(this.entity.right).scale(this.cameraScript.velX*this.speed),this.forceZ.copy(this.entity.forward).scale(-this.cameraScript.velZ*this.speed),this.cameraScript.LTouch){var s=this.direction;this.checkTouch(),s!==this.direction&&this.setDirection(this.direction),this.force=this.forceX.add(this.forceZ).normalize().scale(80)}var a=new pc.Vec3(this.force.x*e,0,this.force.z*e);a.normalize().scale(this.speed),a.add(this.entity.getPosition());var c=this.cameraScript.eulers.x+180,o=new pc.Vec3(0,c,0);this.entity.rigidbody.teleport(a,o)},PlayerMovement.prototype.CheckPCInput=function(){var e=this.app,t=e.keyboard.isPressed(pc.KEY_W)||e.keyboard.isPressed(pc.KEY_UP),i=e.keyboard.isPressed(pc.KEY_A)||e.keyboard.isPressed(pc.KEY_LEFT),r=e.keyboard.isPressed(pc.KEY_S)||e.keyboard.isPressed(pc.KEY_DOWN),s=e.keyboard.isPressed(pc.KEY_D)||e.keyboard.isPressed(pc.KEY_RIGHT);if(t&&!r)if(i&&!s)this.direction="Run Forward Left",this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:-135,z:0},.1,pc.Linear).start();else if(s&&!i){this.direction="Run Forward Right",this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:135,z:0},.1,pc.Linear).start()}else{this.direction="Run Forward",this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:180,z:0},.1,pc.Linear).start()}else if(r&&!t){if(i&&!s)this.direction="Run Backward Left",this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:-45,z:0},.1,pc.Linear).start();else if(s&&!i){this.direction="Run Backward Right",this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:45,z:0},.1,pc.Linear).start()}else{this.direction="Run Backward",this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:0,z:0},.1,pc.Linear).start()}}else if(i&&!s){this.direction="Run Left",this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:-90,z:0},.1,pc.Linear).start()}else if(s&&!i){this.direction="Run Right",this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:90,z:0},.1,pc.Linear).start()}else this.direction="Idle"},PlayerMovement.prototype.checkTouch=function(){this.app;if(this.cameraScript.velZ<-this.velMax&&this.cameraScript.velX<-this.velMax)this.direction="Run Forward Left";else if(this.cameraScript.velZ<-this.velMax&&this.cameraScript.velX>this.velMax)this.direction="Run Forward Right";else if(this.cameraScript.velZ<0&&this.cameraScript.velX<this.velMax&&this.cameraScript.velX>-this.velMax){this.direction="Run Forward",this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:180,z:0},.1,pc.Linear).start()}else if(this.cameraScript.velZ>this.velMax&&this.cameraScript.velX<-this.velMax)this.direction="Run Backward Left";else if(this.cameraScript.velZ>this.velMax&&this.cameraScript.velX>this.velMax)this.direction="Run Backward Right";else if(this.cameraScript.velZ>0&&this.cameraScript.velX<this.velMax&&this.cameraScript.velX>-this.velMax){this.direction="Run Backward",this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:0,z:0},.1,pc.Linear).start()}else if(this.cameraScript.velZ<this.velMax&&this.cameraScript.velZ>-this.velMax&&this.cameraScript.velX<-this.velMin){this.direction="Run Left",this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:-90,z:0},.1,pc.Linear).start()}else if(this.cameraScript.velZ<this.velMax&&this.cameraScript.velZ>-this.velMax&&this.cameraScript.velX>this.velMin){this.direction="Run Right",this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:90,z:0},.1,pc.Linear).start()}else this.direction="Idle"},PlayerMovement.prototype.keyChange=function(e){this.direction;this.CheckPCInput(),this.direction},PlayerMovement.prototype.setDirection=function(e){this.direction=e,this.entity.animation.play(e,this.blendTime)};var PlayerAnimationHandler=pc.createScript("playerAnimationHandler");PlayerAnimationHandler.attributes.add("blendTime",{type:"number",default:.2}),PlayerAnimationHandler.attributes.add("velMin",{type:"number",default:10}),PlayerAnimationHandler.attributes.add("velMax",{type:"number",default:50}),PlayerAnimationHandler.attributes.add("Model",{type:"entity"}),PlayerAnimationHandler.prototype.initialize=function(){var i=this.app,t=i.root.findByName("Camera");this.cameraScript=t.script.cameraMovement,i.keyboard.on(pc.EVENT_KEYDOWN,this.keyChange,this),i.keyboard.on(pc.EVENT_KEYUP,this.keyChange,this),this.direction="Idle",this.setDirection("Idle")},PlayerAnimationHandler.prototype.update=function(i){if(this.cameraScript.LTouch){var t=this.direction;this.checkTouch(),t!==this.direction&&this.setDirection(this.direction)}},PlayerAnimationHandler.prototype.checkButtons=function(){var i=this.app,t=i.keyboard.isPressed(pc.KEY_W)||i.keyboard.isPressed(pc.KEY_UP),e=i.keyboard.isPressed(pc.KEY_A)||i.keyboard.isPressed(pc.KEY_LEFT),a=i.keyboard.isPressed(pc.KEY_S)||i.keyboard.isPressed(pc.KEY_DOWN),r=i.keyboard.isPressed(pc.KEY_D)||i.keyboard.isPressed(pc.KEY_RIGHT);this.direction=t&&!a?e&&!r?"Run Forward Left":r&&!e?"Run Forward Right":"Run Forward":a&&!t?e&&!r?"Run Backward Left":r&&!e?"Run Backward Right":"Run Backward":e&&!r?"Run Left":r&&!e?"Run Right":"Idle"},PlayerAnimationHandler.prototype.checkTouch=function(){this.app;this.cameraScript.velZ<-this.velMax&&this.cameraScript.velX<-this.velMax?this.direction="Run Forward Left":this.cameraScript.velZ<-this.velMax&&this.cameraScript.velX>this.velMax?this.direction="Run Forward Right":this.cameraScript.velZ<0&&this.cameraScript.velX<this.velMax&&this.cameraScript.velX>-this.velMax?this.direction="Run Forward":this.cameraScript.velZ>this.velMax&&this.cameraScript.velX<-this.velMax?this.direction="Run Backward Left":this.cameraScript.velZ>this.velMax&&this.cameraScript.velX>this.velMax?this.direction="Run Backward Right":this.cameraScript.velZ>0&&this.cameraScript.velX<this.velMax&&this.cameraScript.velX>-this.velMax?this.direction="Run Backward":this.cameraScript.velZ<this.velMax&&this.cameraScript.velZ>-this.velMax&&this.cameraScript.velX<-this.velMin?this.direction="Run Left":this.cameraScript.velZ<this.velMax&&this.cameraScript.velZ>-this.velMax&&this.cameraScript.velX>this.velMin?this.direction="Run Right":this.direction="Idle"},PlayerAnimationHandler.prototype.keyChange=function(i){var t=this.direction;this.checkButtons(),t!==this.direction&&("Run Left"===this.direction?(this.Model.anim.setBoolean("Swiming",!0),this.Model.anim.setTrigger("TurnLeft")):"Run Right"===this.direction?(this.Model.anim.setBoolean("Swiming",!0),this.Model.anim.setTrigger("TurnRight")):"Run Forward"===this.direction||"Run Backward"===this.direction||"Run Forward Left"===this.direction||"Run Backward Right"===this.direction?this.Model.anim.setBoolean("Swiming",!0):"Idle"===this.direction&&this.Model.anim.setBoolean("Swiming",!1))},PlayerAnimationHandler.prototype.setDirection=function(i){};var GlobalVariables=pc.createScript("globalVariables");GlobalVariables.attributes.add("IsGamePause",{type:"boolean",default:!1}),GlobalVariables.attributes.add("IsControllBlocked",{type:"boolean",default:!1}),GlobalVariables.attributes.add("GameManager",{type:"entity"}),GlobalVariables.attributes.add("SoundManager",{type:"entity"}),GlobalVariables.attributes.add("UIManager",{type:"entity"}),GlobalVariables.attributes.add("IsGroupWhaleDeteced",{type:"boolean",default:!1}),GlobalVariables.prototype.initialize=function(){window.globalVariables=this};pc.script.createLoadingScreen((function(e){var n,t;n=["body {","    background-color: #283538;","}","","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #088A08;","}","","#application-splash {","    position: absolute;","    top: calc(50% - 28px);","    width: 264px;","    left: calc(50% - 132px);","}","","#application-splash img {","    position: absolute;","    margin: 20px auto 0 auto;","    width: 50%;","    left: 25%;","}","","#progress-bar-container {","    margin: 20px auto 0 auto;","    height: 20px;","    width: 100%;","    border: black;","    border-color: white;","    border-style: solid;","    border-width: 5px;","    box-shadow: 5px 5px;","    border-radius: 10px;","    background-color: #A9F5D0;","}","","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #088A08;","}","","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}"].join("\n"),(t=document.createElement("style")).type="text/css",t.styleSheet?t.styleSheet.cssText=n:t.appendChild(document.createTextNode(n)),document.head.appendChild(t),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e);var n=document.createElement("div");n.id="application-splash",e.appendChild(n),n.style.display="none";var t=document.createElement("div");t.id="progress-bar-container",n.appendChild(t);var a=document.createElement("div");a.id="progress-bar",t.appendChild(a);var r=document.createElement("img");r.src="data:image/png;base64,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",n.appendChild(r),r.onload=function(){n.style.display="block"}}(),e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var n=document.getElementById("progress-bar");n&&(e=Math.min(1,Math.max(0,e)),n.style.width=100*e+"%")})),e.on("start",(function(){var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e)}))}));var CameraFollow=pc.createScript("cameraFollow");CameraFollow.attributes.add("GameManagerEntity",{type:"entity",title:"GameManager Entity"}),CameraFollow.attributes.add("HumanCameraPosition",{type:"vec3"}),CameraFollow.attributes.add("HorseCameraPosition",{type:"vec3"}),CameraFollow.attributes.add("BoatCameraPosition",{type:"vec3"}),CameraFollow.attributes.add("TrainCameraPosition",{type:"vec3"}),CameraFollow.attributes.add("CarCameraPosition",{type:"vec3"}),CameraFollow.attributes.add("PlanetCameraPosition",{type:"vec3"}),CameraFollow.attributes.add("SpaceShipCameraPosition",{type:"vec3"}),CameraFollow.prototype.initialize=function(){this.pivotPoint=new pc.Vec3,this.inertia=.15},CameraFollow.prototype.SetCameraPosition=function(t){0===t?this.entity.setLocalPosition(this.HumanCameraPosition):1===t?this.entity.setLocalPosition(this.HorseCameraPosition):2===t?this.entity.setLocalPosition(this.BoatCameraPosition):3===t?this.entity.setLocalPosition(this.TrainCameraPosition):4===t?this.entity.setLocalPosition(this.CarCameraPosition):5===t?this.entity.setLocalPosition(this.PlanetCameraPosition):6===t&&this.entity.setLocalPosition(this.SpaceShipCameraPosition)},CameraFollow.prototype.update=function(t){if(!globalVariables.IsGamePause){var i=Math.min(t/this.inertia,1),a=this.GameManagerEntity.script.gameManager.CameraFollowEntity.getPosition();a=new pc.Vec3(this.entity.getPosition().x,this.entity.getPosition().y,a.z),this.pivotPoint.lerp(this.entity.getPosition(),a,i),this.entity.setPosition(this.pivotPoint)}};var CameraFollowHandler=pc.createScript("cameraFollowHandler");CameraFollowHandler.attributes.add("FollowTarget",{type:"entity"}),CameraFollowHandler.prototype.initialize=function(){this.pivotPoint=new pc.Vec3,this.inertia=.35},CameraFollowHandler.prototype.update=function(t){var i=Math.min(t/this.inertia,1),e=this.FollowTarget.getPosition();e=new pc.Vec3(this.entity.getPosition().x,this.entity.getPosition().y,e.z),this.pivotPoint.lerp(this.entity.getPosition(),e,i),this.entity.setPosition(this.pivotPoint)};var WhaleAnimationHandler=pc.createScript("whaleAnimationHandler");WhaleAnimationHandler.attributes.add("blendTime",{type:"number",default:.2}),WhaleAnimationHandler.attributes.add("velMin",{type:"number",default:10}),WhaleAnimationHandler.attributes.add("velMax",{type:"number",default:50}),WhaleAnimationHandler.attributes.add("Model",{type:"entity"}),WhaleAnimationHandler.attributes.add("ModelRoot",{type:"entity"}),WhaleAnimationHandler.attributes.add("Camera",{type:"entity"}),WhaleAnimationHandler.attributes.add("CameraTarget1",{type:"entity"}),WhaleAnimationHandler.attributes.add("CameraTarget2",{type:"entity"}),WhaleAnimationHandler.attributes.add("LeftBtn",{type:"entity"}),WhaleAnimationHandler.attributes.add("RightBtn",{type:"entity"}),WhaleAnimationHandler.attributes.add("ForwardBtn",{type:"entity"}),WhaleAnimationHandler.prototype.initialize=function(){var t=this.app;t.keyboard.on(pc.EVENT_KEYDOWN,this.keyChange,this),t.keyboard.on(pc.EVENT_KEYUP,this.keyChange,this),this.direction="Idle",this.LeftBtn.button.on(pc.EVENT_TOUCHSTART,this.OnLeftBtnTouchStart,this),this.RightBtn.button.on(pc.EVENT_TOUCHSTART,this.OnRightBtnTouchStart,this),this.ForwardBtn.button.on(pc.EVENT_TOUCHSTART,this.OnForwardBtnTouchStart,this),this.LeftBtn.button.on(pc.EVENT_TOUCHEND,this.OnLeftBtnTouchEnd,this),this.RightBtn.button.on(pc.EVENT_TOUCHEND,this.OnRightBtnTouchEnd,this),this.ForwardBtn.button.on(pc.EVENT_TOUCHEND,this.OnForwardBtnTouchEnd,this),this.LeftTouch=!1,this.RightTouch=!1,this.ForwardTouch=!1},WhaleAnimationHandler.prototype.update=function(t){this.app.touch&&this.keyChange()},WhaleAnimationHandler.prototype.OnLeftBtnTouchStart=function(t){this.LeftTouch=!0},WhaleAnimationHandler.prototype.OnRightBtnTouchStart=function(t){this.RightTouch=!0},WhaleAnimationHandler.prototype.OnForwardBtnTouchStart=function(t){this.ForwardTouch=!0},WhaleAnimationHandler.prototype.OnLeftBtnTouchEnd=function(t){t.event.preventDefault(),this.LeftTouch=!1},WhaleAnimationHandler.prototype.OnRightBtnTouchEnd=function(t){t.event.preventDefault(),this.RightTouch=!1},WhaleAnimationHandler.prototype.OnForwardBtnTouchEnd=function(t){t.event.preventDefault(),this.ForwardTouch=!1},WhaleAnimationHandler.prototype.checkButtons=function(){var t=this.app,e=t.keyboard.isPressed(pc.KEY_W)||t.keyboard.isPressed(pc.KEY_UP)||this.ForwardTouch,i=t.keyboard.isPressed(pc.KEY_A)||t.keyboard.isPressed(pc.KEY_LEFT)||this.LeftTouch,n=t.keyboard.isPressed(pc.KEY_D)||t.keyboard.isPressed(pc.KEY_RIGHT)||this.RightTouch;this.direction=e?i&&!n?"Run Forward Left":n&&!i?"Run Forward Right":"Run Forward":i&&!n?"Run Left":n&&!i?"Run Right":"Idle"},WhaleAnimationHandler.prototype.keyChange=function(t){if(!globalVariables.IsControllBlocked){var e=this.direction;if(this.checkButtons(),e!==this.direction)if("Run Left"===this.direction)this.Model.anim.setBoolean("Swiming",!0),this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:0,z:-30},.5,pc.Linear).start();else if("Run Right"===this.direction){this.Model.anim.setBoolean("Swiming",!0),this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:0,z:30},.5,pc.Linear).start()}else if("Run Forward"===this.direction){this.Model.anim.setBoolean("Swiming",!0),this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:0,z:0},.5,pc.Linear).start(),this.Camera.script.cameraFollowHandler.FollowTarget=this.CameraTarget2}else if("Run Forward Left"===this.direction){this.Model.anim.setBoolean("Swiming",!0),this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:0,z:-15},.5,pc.Linear).start()}else if("Run Forward Right"===this.direction){this.Model.anim.setBoolean("Swiming",!0),this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:0,z:15},.5,pc.Linear).start()}else if("Idle"===this.direction){this.Model.anim.setBoolean("Swiming",!1),this.Model.tween(this.Model.getLocalEulerAngles()).rotate({x:0,y:0,z:0},.5,pc.Linear).start(),this.Camera.script.cameraFollowHandler.FollowTarget=this.CameraTarget1}}};var WhaleRing=pc.createScript("whaleRing");WhaleRing.attributes.add("Speed",{type:"number"}),WhaleRing.attributes.add("Scale",{type:"number"}),WhaleRing.prototype.initialize=function(){this.timer=0},WhaleRing.prototype.update=function(t){this.entity.translate(0,0,this.Speed*t);var e=this.Scale+this.entity.getLocalScale().x;this.entity.setLocalScale(e,e,e),this.timer+=t,this.timer>=3&&(this.entity.enabled=!1,this.timer=0)};var RingScale=pc.createScript("ringScale");RingScale.attributes.add("Scale",{type:"number"}),RingScale.prototype.initialize=function(){this.timer=0,this.entity.setLocalScale(0,1,0)},RingScale.prototype.update=function(t){var e=this.Scale*t+this.entity.getLocalScale().x;this.entity.setLocalScale(e,1,e),this.timer+=t,this.timer>=3&&(this.entity.enabled=!1,this.timer=0)};var WaveSpawner=pc.createScript("waveSpawner");WaveSpawner.attributes.add("interval",{type:"number",default:1}),WaveSpawner.attributes.add("IsGroup",{type:"boolean",default:!0}),WaveSpawner.prototype.initialize=function(){this.timer=0},WaveSpawner.prototype.update=function(t){if(this.timer+=t,this.timer>=this.interval&&!this.IsGroup){var e=this.app.root.findByName("WhaleWave_V2").clone(),i=this.entity.getPosition();e.setPosition(i),e.rotateLocal(this.entity.getEulerAngles()),e.enabled=!0,this.app.root.addChild(e),this.timer=0}else if(this.timer>=this.interval&&this.IsGroup){var a=this.app.root.findByName("WhaleGroupWave_V2").clone(),r=this.entity.getPosition();a.setPosition(r),a.rotate(this.entity.getEulerAngles()),a.enabled=!0,this.app.root.addChild(a),this.timer=0}};var FogOnoff=pc.createScript("fogOnoff");FogOnoff.attributes.add("FogOn",{type:"boolean",default:!0}),FogOnoff.attributes.add("OnTriger",{type:"boolean",default:!0}),FogOnoff.prototype.initialize=function(){},FogOnoff.prototype.update=function(t){this.FogOn&&this.OnTriger&&(this.app.scene.fog=pc.FOG_LINEAR,this.OnTriger=!1),!this.FogOn&&this.OnTriger&&(this.app.scene.fog=pc.FOG_NONE,this.OnTriger=!1)};var CookieAnimator=pc.createScript("cookieAnimator");CookieAnimator.attributes.add("Speed",{type:"number"}),CookieAnimator.prototype.initialize=function(){},CookieAnimator.prototype.update=function(t){this.entity.light.cookieAngle+=this.Speed,this.entity.light.cookieOffset.x+=this.Speed/1e3,this.entity.light.cookieOffset.y+=this.Speed/1e3,360==this.entity.light.cookieAngle&&(this.entity.light.cookieAngle=0)};var Projector=pc.createScript("projector");Projector.attributes.add("videoUrl",{type:"string"}),Projector.prototype.initialize=function(){var e=this.app,o=new pc.Texture(e.graphicsDevice,{format:pc.PIXELFORMAT_R5_G6_B5,autoMipmap:!1});o.minFilter=pc.FILTER_LINEAR,o.magFilter=pc.FILTER_LINEAR,o.addressU=pc.ADDRESS_CLAMP_TO_EDGE,o.addressV=pc.ADDRESS_CLAMP_TO_EDGE;var t=document.createElement("video");t.addEventListener("canplay",(function(e){o.setSource(t)})),t.src=this.videoUrl,t.crossOrigin="anonymous",t.loop=!0,t.muted=!0,t.autoplay=!0,t.play(),this.videoTexture=o,this.upload=!0;var i=this.entity.light;i.cookie=o;var r=i.cookieScale;r.x=1.777777,i.cookieScale=r,i.cookieFalloff=!0;var a=i.cookieOffset;a=pc.Vec2.ZERO,i.cookieOffset=a},Projector.prototype.update=function(e){this.upload=!this.upload,this.upload&&this.videoTexture.upload()};var WhaleGroupHandler=pc.createScript("whaleGroupHandler");WhaleGroupHandler.attributes.add("SpawningPoints",{type:"vec3",array:!0}),WhaleGroupHandler.attributes.add("WhaleA",{type:"entity"}),WhaleGroupHandler.attributes.add("WhaleB",{type:"entity"}),WhaleGroupHandler.prototype.initialize=function(){var a=Math.random()*this.SpawningPoints.length;a=Math.floor(a),this.entity.setPosition(this.SpawningPoints[a])},WhaleGroupHandler.prototype.update=function(a){this.entity.lookAt(globalVariables.GameManager.script.gameManager.WhalePlayer.getPosition())},WhaleGroupHandler.prototype.PlayHappyAnimation=function(){this.WhaleA.anim.setBoolean("GameOver",!0),this.WhaleB.anim.setBoolean("GameOver",!0)};var FollowWorldTarget=pc.createScript("followWorldTarget");FollowWorldTarget.attributes.add("target",{type:"entity"}),FollowWorldTarget.attributes.add("camera",{type:"entity"}),FollowWorldTarget.prototype.postUpdate=function(e){var t=this.target.getPosition(),a=new pc.Vec3;if(this.camera.camera.worldToScreen(t,a),a.z>0){this.entity.element.enabled=!0;var i=this.app.graphicsDevice.maxPixelRatio;a.x*=i,a.y*=i;var r=this.entity.element.screen.screen.scale,o=this.app.graphicsDevice;this.entity.setLocalPosition(a.x/r,(o.height-a.y)/r,0)}else this.entity.element.enabled=!1};var BatteryCollector=pc.createScript("batteryCollector");BatteryCollector.prototype.initialize=function(){};var Halo=pc.createScript("halo");Halo.attributes.add("camera",{type:"entity"}),Halo.attributes.add("unidirectional",{type:"boolean",default:!1}),Halo.tmp=new pc.Vec3,Halo.prototype.initialize=function(){this.plane=this.entity.getChildren()[0],this.parent=this.entity.getParent()},Halo.prototype.update=function(t){var a=Halo.tmp;a.copy(this.parent.forward).scale(-1);var e=this.plane.model.meshInstances;if(this.camera)if(this.entity.lookAt(this.camera.getPosition()),this.unidirectional){var i=-1*a.dot(this.camera.forward);i<0&&(i=0),e[0].setParameter("material_opacity",i)}else e[0].setParameter("material_opacity",1)};pc.extend(pc,function(){function computeGaussian(e,t){return 1/Math.sqrt(2*Math.PI*t)*Math.exp(-e*e/(2*t*t))}function calculateBlurValues(e,t,s,o,r){e[0]=computeGaussian(0,r),t[0]=0,t[1]=0;var i,a,l=e[0];for(i=0,a=Math.floor(7.5);i<a;i++){var u=computeGaussian(i+1,r);e[2*i]=u,e[2*i+1]=u,l+=2*u;var h=2*i+1.5;t[4*i]=s*h,t[4*i+1]=o*h,t[4*i+2]=-s*h,t[4*i+3]=-o*h}for(i=0,a=e.length;i<a;i++)e[i]/=l}var BloomEffect=function(e){var t={aPosition:pc.SEMANTIC_POSITION},s=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition + 1.0) * 0.5;","}"].join("\n"),o=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join("\n"),r=["precision "+e.precision+" float;","","#define SAMPLE_COUNT 15","","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets[SAMPLE_COUNT];","uniform float uBlurWeights[SAMPLE_COUNT];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join("\n"),i=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join("\n");this.extractShader=new pc.Shader(e,{attributes:t,vshader:s,fshader:o}),this.blurShader=new pc.Shader(e,{attributes:t,vshader:s,fshader:r}),this.combineShader=new pc.Shader(e,{attributes:t,vshader:s,fshader:i});var a=e.width,l=e.height;this.targets=[];for(var u=0;u<2;u++){var h=new pc.Texture(e,{format:pc.PIXELFORMAT_R8_G8_B8_A8,width:a>>1,height:l>>1});h.minFilter=pc.FILTER_LINEAR,h.magFilter=pc.FILTER_LINEAR,h.addressU=pc.ADDRESS_CLAMP_TO_EDGE,h.addressV=pc.ADDRESS_CLAMP_TO_EDGE;var n=new pc.RenderTarget(e,h,{depth:!1});this.targets.push(n)}this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(15),this.sampleOffsets=new Float32Array(30)};return(BloomEffect=pc.inherits(BloomEffect,pc.PostEffect)).prototype=pc.extend(BloomEffect.prototype,{render:function(e,t,s){var o=this.device,r=o.scope;r.resolve("uBloomThreshold").setValue(this.bloomThreshold),r.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(o,this.targets[0],this.vertexBuffer,this.extractShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),pc.drawFullscreenQuad(o,this.targets[1],this.vertexBuffer,this.blurShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),pc.drawFullscreenQuad(o,this.targets[0],this.vertexBuffer,this.blurShader),r.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),r.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(o,t,this.vertexBuffer,this.combineShader,s)}}),{BloomEffect:BloomEffect}}());var Bloom=pc.createScript("bloom");Bloom.attributes.add("bloomIntensity",{type:"number",default:1,min:0,title:"Intensity"}),Bloom.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,precision:2,title:"Threshold"}),Bloom.attributes.add("blurAmount",{type:"number",default:4,min:1,title:"Blur amount"}),Bloom.prototype.initialize=function(){this.effect=new pc.BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount,this.effect.bloomIntensity=this.bloomIntensity;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("attr",(function(e,t){this.effect[e]=t}),this),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)}))};pc.extend(pc,function(){var BrightnessContrastEffect=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uBrightness;","uniform float uContrast;","varying vec2 vUv0;","void main() {","gl_FragColor = texture2D( uColorBuffer, vUv0 );","gl_FragColor.rgb += uBrightness;","if (uContrast > 0.0) {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - uContrast) + 0.5;","} else {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + uContrast) + 0.5;","}","}"].join("\n")}),this.brightness=0,this.contrast=0};return(BrightnessContrastEffect=pc.inherits(BrightnessContrastEffect,pc.PostEffect)).prototype=pc.extend(BrightnessContrastEffect.prototype,{render:function(t,e,r){var s=this.device,i=s.scope;i.resolve("uBrightness").setValue(this.brightness),i.resolve("uContrast").setValue(this.contrast),i.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(s,e,this.vertexBuffer,this.shader,r)}}),{BrightnessContrastEffect:BrightnessContrastEffect}}());var BrightnessContrast=pc.createScript("brightnessContrast");BrightnessContrast.attributes.add("brightness",{type:"number",default:0,min:-1,max:1,precision:5,title:"Brightness"}),BrightnessContrast.attributes.add("contrast",{type:"number",default:0,min:-1,max:1,precision:5,title:"Contrast"}),BrightnessContrast.prototype.initialize=function(){this.effect=new pc.BrightnessContrastEffect(this.app.graphicsDevice),this.effect.brightness=this.brightness,this.effect.contrast=this.contrast,this.on("attr",(function(t,e){this.effect[t]=e}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};pc.extend(pc,function(){var VignetteEffect=function(e){var t={aPosition:pc.SEMANTIC_POSITION},i=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),s=["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","uniform float uDarkness;","uniform float uOffset;","","varying vec2 vUv0;","","void main() {","    vec4 texel = texture2D(uColorBuffer, vUv0);","    vec2 uv = (vUv0 - vec2(0.5)) * vec2(uOffset);","    gl_FragColor = vec4(mix(texel.rgb, vec3(1.0 - uDarkness), dot(uv, uv)), texel.a);","}"].join("\n");this.vignetteShader=new pc.Shader(e,{attributes:t,vshader:i,fshader:s}),this.offset=1,this.darkness=1};return(VignetteEffect=pc.inherits(VignetteEffect,pc.PostEffect)).prototype=pc.extend(VignetteEffect,{render:function(e,t,i){var s=this.device,f=s.scope;f.resolve("uColorBuffer").setValue(e.colorBuffer),f.resolve("uOffset").setValue(this.offset),f.resolve("uDarkness").setValue(this.darkness),pc.drawFullscreenQuad(s,t,this.vertexBuffer,this.vignetteShader,i)}}),{VignetteEffect:VignetteEffect}}());var Vignette=pc.createScript("vignette");Vignette.attributes.add("offset",{type:"number",default:1,min:0,precision:5,title:"Offset"}),Vignette.attributes.add("darkness",{type:"number",default:1,precision:5,title:"Darkness"}),Vignette.prototype.initialize=function(){this.effect=new pc.VignetteEffect(this.app.graphicsDevice),this.effect.offset=this.offset,this.effect.darkness=this.darkness,this.on("attr",(function(e,t){this.effect[e]=t}),this);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)}))};